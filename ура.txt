import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, MenuButtonCommands, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
TOKEN = "8387232890:AAGDhHOREkXmN58idiP8tgBWWLVF9mgCdZ8"

# ========== –°–û–ó–î–ê–ù–ò–ï –ö–õ–ê–í–ò–ê–¢–£–† ==========
def get_main_menu_keyboard():
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Äî Reply Keyboard (—Ä—è–¥–æ–º —Å–æ –∑–Ω–∞—á–∫–æ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)"""
    keyboard = [
        [KeyboardButton("–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ üìÖ")],
        [KeyboardButton("–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è üé§"), KeyboardButton("–ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ üé∏")],
        [KeyboardButton("–ú–∞—Ä—à—Ä—É—Ç–Ω—ã–µ –ª–∏—Å—Ç—ã üö∂")],
        [KeyboardButton("–ó–∞–ø–∏—Å—å –Ω–∞ –ö–≤–∏–∑–±–æ—Ä üìö")],
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True, is_persistent=True)


def get_main_menu_inline():
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Äî Inline (–¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤)"""
    keyboard = [
        [InlineKeyboardButton("üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data='schedule')],
        [InlineKeyboardButton("üéß –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è", callback_data='listenings')],
        [InlineKeyboardButton("üîß –ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ", callback_data='workshops')],
        [InlineKeyboardButton("üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç–Ω—ã–µ –ª–∏—Å—Ç—ã", callback_data='routes')],
        [InlineKeyboardButton("üéØ –ó–∞–ø–∏—Å—å –Ω–∞ –ö–≤–∏–∑–±–æ—Ä", callback_data='quizbor')],
        [InlineKeyboardButton("‚ÑπÔ∏è –û –±–æ—Ç–µ", callback_data='about')],
        [InlineKeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", callback_data='settings')]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_schedule_keyboard():
    """–ú–µ–Ω—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è"""
    keyboard = [
        [InlineKeyboardButton("üìÜ –ù–∞ –Ω–µ–¥–µ–ª—é", callback_data='schedule_week')],
        [InlineKeyboardButton("üìÖ –ù–∞ –º–µ—Å—è—Ü", callback_data='schedule_month')],
        [InlineKeyboardButton("üë§ –õ–∏—á–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data='schedule_personal')],
        [InlineKeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ", callback_data='schedule_add')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_listenings_keyboard():
    """–ú–µ–Ω—é –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–π"""
    keyboard = [
        [InlineKeyboardButton("üéµ –ù–æ–≤—ã–µ", callback_data='listening_new')],
        [InlineKeyboardButton("üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ", callback_data='listening_popular')],
        [InlineKeyboardButton("üè∑Ô∏è –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º", callback_data='listening_categories')],
        [InlineKeyboardButton("üíæ –ú–æ–∏ –∞—É–¥–∏–æ", callback_data='listening_my')],
        [InlineKeyboardButton("üìÅ –ê—Ä—Ö–∏–≤", callback_data='listening_archive')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_workshops_keyboard():
    """–ú–µ–Ω—é –º–∞—Å—Ç–µ—Ä—Å–∫–∏—Ö"""
    keyboard = [
        [InlineKeyboardButton("üî® –ë–ª–∏–∂–∞–π—à–∏–µ", callback_data='workshop_upcoming')],
        [InlineKeyboardButton("üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", callback_data='workshop_join')],
        [InlineKeyboardButton("üë§ –ú–æ–∏ –º–∞—Å—Ç–µ—Ä—Å–∫–∏–µ", callback_data='workshop_my')],
        [InlineKeyboardButton("‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ", callback_data='workshop_favorites')],
        [InlineKeyboardButton("üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º", callback_data='workshop_organize')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_routes_keyboard():
    """–ú–µ–Ω—é –º–∞—Ä—à—Ä—É—Ç–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤"""
    keyboard = [
        [InlineKeyboardButton("üÜï –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç", callback_data='route_create')],
        [InlineKeyboardButton("üìã –ú–æ–∏ –º–∞—Ä—à—Ä—É—Ç—ã", callback_data='route_my')],
        [InlineKeyboardButton("üë• –û–±—â–∏–µ", callback_data='route_shared')],
        [InlineKeyboardButton("üìç –®–∞–±–ª–æ–Ω—ã", callback_data='route_templates')],
        [InlineKeyboardButton("üîÑ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç", callback_data='route_import')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_quizbor_keyboard():
    """–ú–µ–Ω—é –ö–≤–∏–∑–±–æ—Ä–∞"""
    keyboard = [
        [InlineKeyboardButton("‚úçÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", callback_data='quiz_join')],
        [InlineKeyboardButton("üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data='quiz_schedule')],
        [InlineKeyboardButton("üìä –ú–æ–∏ –∑–∞–ø–∏—Å–∏", callback_data='quiz_my')],
        [InlineKeyboardButton("üèÜ –†–µ–π—Ç–∏–Ω–≥", callback_data='quiz_rating')],
        [InlineKeyboardButton("‚ùì –ü—Ä–∞–≤–∏–ª–∞", callback_data='quiz_rules')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
    ]
    return InlineKeyboardMarkup(keyboard)

def get_settings_keyboard():
    """–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
    keyboard = [
        [InlineKeyboardButton("üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", callback_data='settings_notify')],
        [InlineKeyboardButton("üé® –¢–µ–º–∞", callback_data='settings_theme')],
        [InlineKeyboardButton("üåê –Ø–∑—ã–∫", callback_data='settings_language')],
        [InlineKeyboardButton("üîê –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å", callback_data='settings_privacy')],
        [InlineKeyboardButton("üì± –ü–æ–¥–ø–∏—Å–∫–∞", callback_data='settings_subscription')],
        [InlineKeyboardButton("‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_main')]
    ]
    return InlineKeyboardMarkup(keyboard)

# ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î ==========
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user = update.effective_user
    welcome_text = (
        f"üëã –ü—Ä–∏–≤–µ—Ç, {user.first_name}!\n\n"
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é:"
    )
    
    await update.message.reply_text(
        welcome_text,
        reply_markup=get_main_menu_keyboard(),
        parse_mode='HTML'
    )

async def menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /menu"""
    await update.message.reply_text(
        "üì± <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:",
        reply_markup=get_main_menu_keyboard(),
        parse_mode='HTML'
    )


def get_reply_for_menu_button(text: str) -> tuple[str, InlineKeyboardMarkup] | None:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (—Ç–µ–∫—Å—Ç, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞) –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é"""
    menus = {
        "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ üìÖ": ("üìÖ <b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", get_schedule_keyboard()),
        "–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è üé§": ("üéß <b>–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è</b>\n–ê—É–¥–∏–æ–º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ª–µ–∫—Ü–∏–∏:", get_listenings_keyboard()),
        "–ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ üé∏": ("üîß <b>–ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ</b>\n–û–±—É—á–µ–Ω–∏–µ –∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã:", get_workshops_keyboard()),
        "–ú–∞—Ä—à—Ä—É—Ç–Ω—ã–µ –ª–∏—Å—Ç—ã üö∂": ("üó∫Ô∏è <b>–ú–∞—Ä—à—Ä—É—Ç–Ω—ã–µ –ª–∏—Å—Ç—ã</b>\n–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è:", get_routes_keyboard()),
        "–ó–∞–ø–∏—Å—å –Ω–∞ –ö–≤–∏–∑–±–æ—Ä üìö": ("üéØ <b>–ö–≤–∏–∑–±–æ—Ä</b>\n–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–≥—Ä—ã:", get_quizbor_keyboard()),
    }
    return menus.get(text)

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = (
        "<b>üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n\n"
        "/start ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n"
        "/menu ‚Äî –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
        "/help ‚Äî –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
        "/about ‚Äî –û –ø—Ä–æ–µ–∫—Ç–µ\n\n"
        "<b>üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b>\n"
        "–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º."
    )
    await update.message.reply_text(help_text, parse_mode='HTML')

async def about(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /about"""
    about_text = (
        "<b>ü§ñ –û –±–æ—Ç–µ</b>\n\n"
        "‚Ä¢ <b>–í–µ—Ä—Å–∏—è:</b> 2.0.0\n"
        "‚Ä¢ <b>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</b> –ö–æ–º–∞–Ω–¥–∞ QuizMaster\n"
        "‚Ä¢ <b>–î–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞:</b> –§–µ–≤—Ä–∞–ª—å 2024\n\n"
        "üìö <b>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</b>\n"
        "‚úì –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º\n"
        "‚úì –î–æ—Å—Ç—É–ø –∫ –∞—É–¥–∏–æ–º–∞—Ç–µ—Ä–∏–∞–ª–∞–º\n"
        "‚úì –ó–∞–ø–∏—Å—å –Ω–∞ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã\n"
        "‚úì –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤\n"
        "‚úì –£—á–∞—Å—Ç–∏–µ –≤ –∫–≤–∏–∑–∞—Ö\n\n"
        "üí° –ë–æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è!"
    )
    await update.message.reply_text(about_text, parse_mode='HTML')

# ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–ù–û–ü–û–ö ==========
async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏"""
    query = update.callback_query
    await query.answer()
    
    data = query.data
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–µ –º–µ–Ω—é –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
    if data == 'back_main':
        text = "üì± <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:"
        reply_markup = get_main_menu_inline()
    
    elif data == 'schedule':
        text = "üìÖ <b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</b>\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
        reply_markup = get_schedule_keyboard()
    
    elif data == 'listenings':
        text = "üéß <b>–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è</b>\n–ê—É–¥–∏–æ–º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ª–µ–∫—Ü–∏–∏:"
        reply_markup = get_listenings_keyboard()
    
    elif data == 'workshops':
        text = "üîß <b>–ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ</b>\n–û–±—É—á–µ–Ω–∏–µ –∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã:"
        reply_markup = get_workshops_keyboard()
    
    elif data == 'routes':
        text = "üó∫Ô∏è <b>–ú–∞—Ä—à—Ä—É—Ç–Ω—ã–µ –ª–∏—Å—Ç—ã</b>\n–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è:"
        reply_markup = get_routes_keyboard()
    
    elif data == 'quizbor':
        text = "üéØ <b>–ö–≤–∏–∑–±–æ—Ä</b>\n–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–≥—Ä—ã:"
        reply_markup = get_quizbor_keyboard()
    
    elif data == 'settings':
        text = "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b>\n–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞:"
        reply_markup = get_settings_keyboard()
    
    elif data == 'about':
        about_text = (
            "<b>‚ÑπÔ∏è –û –±–æ—Ç–µ</b>\n\n"
            "–≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è "
            "–≤–∞—à–∏–º–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏.\n\n"
            "üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>\n"
            "‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 1,250+\n"
            "‚Ä¢ –ú–∞—Å—Ç–µ—Ä—Å–∫–∏—Ö: 45+\n"
            "‚Ä¢ –ö–≤–∏–∑–æ–≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ: 120+\n\n"
            "üîÑ <b>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:</b>\n"
            "–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –º–∞—Ä—Ç 2024"
        )
        await query.edit_message_text(
            about_text, 
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
            ]),
            parse_mode='HTML'
        )
        return
    
    else:
        # –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
        text = f"<b>‚öôÔ∏è –†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</b>\n\n–í—ã –≤—ã–±—Ä–∞–ª–∏: {data.replace('_', ' ').title()}\n\n–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª!"
        reply_markup = InlineKeyboardMarkup([
            [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_main')]
        ])
    
    await query.edit_message_text(text, reply_markup=reply_markup, parse_mode='HTML')

# ========== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
async def post_init(application: Application):
    """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"""
    await application.bot.set_chat_menu_button(menu_button=MenuButtonCommands())

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é"""
    text = update.message.text or ""
    
    if text.lower() in ['–º–µ–Ω—é', 'menu', '–Ω–∞—á–∞—Ç—å']:
        await menu(update, context)
    elif result := get_reply_for_menu_button(text):
        msg_text, inline_kb = result
        await update.message.reply_text(
            msg_text,
            reply_markup=inline_kb,
            parse_mode='HTML'
        )
    else:
        await update.message.reply_text(
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É /menu –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.",
            reply_markup=get_main_menu_keyboard()
        )

# ========== –ó–ê–ü–£–°–ö –ë–û–¢–ê ==========
def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(TOKEN).post_init(post_init).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("menu", menu))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CommandHandler("about", about))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫
    application.add_handler(CallbackQueryHandler(button_handler))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    print("üì± –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –≤ Telegram")
    print("‚ö° –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç...")
    
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == '__main__':
    main()